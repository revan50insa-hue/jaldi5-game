<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Jaldi 5 Multiplayer</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0b0b0b;
  color: #fff;
  text-align: center;
}

h2 {
  margin-top: 20px;
}

button {
  padding: 10px 20px;
  margin: 8px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #ff9800;
  color: #000;
  cursor: pointer;
}

input {
  padding: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  margin: 5px;
}

#ticket {
  background: #fff;
  padding: 12px;
  border-radius: 12px;
  border: 3px solid #000;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 6px;
  max-width: 280px;
  margin: 20px auto;
}

.cell {
  background: #f5f5f5;
  color: #000;
  font-size: 18px;
  font-weight: bold;
  padding: 14px 0;
  border-radius: 6px;
  border: 1.5px solid #000;
}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCeg-D---KoJEtVcBN5iwFs9WDHBRIgZjA",
  authDomain: "tffhacksv4.firebaseapp.com",
  databaseURL: "https://tffhacksv4-default-rtdb.firebaseio.com",
  projectId: "tffhacksv4",
  storageBucket: "tffhacksv4.firebasestorage.app",
  messagingSenderId: "641197191429",
  appId: "1:641197191429:web:7b63ca534dd41e19d8476c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>
</head>

<body>

<h2>Jaldi 5</h2>
<div id="myid"></div>

<button onclick="createGroup()">Create Group</button><br>

<input id="groupInput" placeholder="Enter Group ID">
<button onclick="joinGroup()">Join Group</button>

<br><br>
<button id="startBtn" onclick="startGame()" style="display:none;">Start Game</button>

<h3>Your Ticket</h3>
<div id="ticket"></div>

<script>
let myId = localStorage.getItem("player_id");
if (!myId) {
  myId = "PLR_" + Math.floor(Math.random() * 1000000);
  localStorage.setItem("player_id", myId);
}
document.getElementById("myid").innerText = "My ID: " + myId;

let currentGroup = "";
let isCreator = false;

// Create group
function createGroup() {
  currentGroup = "GROUP_" + Math.floor(Math.random() * 10000);
  db.ref("groups/" + currentGroup + "/players/" + myId).set(true);
  isCreator = true;
  document.getElementById("startBtn").style.display = "inline-block";
  alert("Group ID: " + currentGroup);
}

// Join group
function joinGroup() {
  currentGroup = document.getElementById("groupInput").value;
  db.ref("groups/" + currentGroup + "/players/" + myId).set(true);
}

// Start game
function startGame() {
  db.ref("groups/" + currentGroup + "/players").once("value", snap => {
    snap.forEach(player => {
      let nums = [];
      while (nums.length < 25) {
        let n = Math.floor(Math.random() * 100) + 1;
        if (!nums.includes(n)) nums.push(n);
      }
      db.ref("groups/" + currentGroup + "/tickets/" + player.key).set(nums);
    });
  });
}

// Listen for my ticket
db.ref("groups").on("value", snap => {
  if (!currentGroup) return;
  let ticketSnap = snap.child(currentGroup + "/tickets/" + myId);
  if (ticketSnap.exists()) {
    showTicket(ticketSnap.val());
  }
});

// Render ticket
function showTicket(numbers) {
  let html = "";
  numbers.forEach(n => {
    html += `<div class="cell">${n}</div>`;
  });
  document.getElementById("ticket").innerHTML = html;
}
</script>

</body>
</html>
